import{a as Y,b as E}from "./chunk-MM3EZJ6F.js";import{c as H}from "./chunk-ULSCS6NB.js";import{a as X}from "./chunk-7D2ESANC.js";import{m as q}from "./chunk-CM3QXDGD.js";import{a as Z}from "./chunk-EQDHBBG2.js";import{f as U,g as J,h as K}from "./chunk-FSIF6OGH.js";import{a as z,b as G}from "./chunk-FJUI5PLB.js";import"./chunk-KEFREGMC.js";import"./chunk-VCVNBPRD.js";import"./chunk-6ZGCKHA5.js";import{b as V,c as C}from "./chunk-OMWKF27L.js";import"./chunk-OJSX3Q5S.js";import{A,G as R,H as D,q as g}from "./chunk-GMRP4QB5.js";import{A as N,La as M,Xa as _,_ as O,ca as W,d as b,fa as B,t as F,ta as P,v as T}from "./chunk-WBJK5ZQV.js";import"./chunk-4BCIMHJT.js";import"./chunk-ILE44FN6.js";import{a as h,b as k}from "./chunk-GAL4ENT6.js";var ae=_("remarkMath",()=>Z);function ie(e){return O(e,"math",(t, r, i)=>{let{value:n}=t,a={type:"code",lang:"LaTeX",value:n};i.children.splice(r,1,a)})}var se=_("remarkMathBlock",()=>()=>ie),j=({config:e,innerView:t,updateValue:r})=>{var i;let n= a=>{a.preventDefault(),r?.()};return D`
    <host>
      <div class="container">
        ${t&&R(t.dom,{})}
        <button onmousedown=${n}>
          ${(i=e?.inlineEditConfirm)==null?void 0:i.call(e)}
        </button>
      </div>
    </host>
  `};j.props={config:Object,innerView:Object,updateValue:Function};var ee=A(j),Q=G("INLINE_LATEX"),te=e=>{throw TypeError(e)},re=(e,t,r)=>t.has(e)||te("Cannot "+r),o=(e,t,r)=>(re(e,t,"read from private field"),r?r.call(e):t.get(e)),m=(e,t,r)=>t.has(e)?te("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,i)=>(re(e,t,"write to private field"),t.set(e,r),r),d,c,v,u,x,y,S=class{constructor(t,r,i){this.ctx=t,m(this,d,new ee),m(this,c),m(this,v),m(this,u),m(this,x,()=>{o(this,u)&&(o(this,u).destroy(),f(this,u,null))}),m(this,y,n=>{let s=(()=>{let{selection:l,schema:w}=n.state;if(l.empty||!(l instanceof F))return!1;let I=l.node;if(I.type.name!==Y)return!1;let ne=l.from,oe=w.nodes.paragraph.create(null,w.text(I.attrs.value)),$=new N(o(this,v),{state:T.create({doc:oe,schema:new b({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},text:{group:"inline"}}}),plugins:[P({"Mod-z":V,"Mod-Z":C,"Mod-y":C,Enter:()=>{var p,L;return(L=(p=o(this,d)).updateValue)==null||L.call(p),!0}})]})});return f(this,u,$),o(this,d).innerView=o(this,u),o(this,d).updateValue=()=>{let{tr:p}=n.state;p.setNodeAttribute(ne,"value",$.state.doc.textContent),n.dispatch(p),requestAnimationFrame(()=>{n.focus()})},!0})();return s||o(this,x).call(this),s}),this.update=(n,a)=>{o(this,c).update(n,a)},this.destroy=()=>{o(this,c).destroy(),o(this,d).remove()},f(this,c,new z({debounce:0,content:o(this,d),shouldShow:o(this,y),offset:10,floatingUIOptions:{placement:"bottom"}})),o(this,d).config=i,o(this,c).update(r),f(this,v,document.createElement("div")),f(this,u,null)}};d=new WeakMap;c=new WeakMap;v=new WeakMap;u=new WeakMap;x=new WeakMap;y=new WeakMap;var le=M(e=>B(/(?:\$)([^$]+)(?:\$)$/,E.type(e),{getAttr:t=>{var r;return{value:(r=t[1])!=null?r:""}}})),de=M(e=>W(/^\$\$[\s\n]$/,g.type(e),()=>({language:"LaTeX"}))),ue=g.extendSchema(e=>t=>{let r=e(t);return k(h({},r),{toMarkdown:{match:r.toMarkdown.match,runner:(i,n)=>{var a,s;if(((a=n.attrs.language)!=null?a:"").toLowerCase()==="latex")i.addNode("math",void 0,((s=n.content.firstChild)==null?void 0:s.text)||"");else return r.toMarkdown.runner(i,n)}}})});H("milkdown-latex-inline-edit",ee);var Fe=(e,t)=>{e.config(r=>{if(!r.get(K).includes(J.CodeMirror))throw new Error("You need to enable CodeMirror to use LaTeX feature");r.update(X.key,a=>k(h({},a),{renderPreview:(s,l)=>{if(s.toLowerCase()==="latex"&&l.length>0)return me(l,t?.katexOptions);let w=a.renderPreview;return w(s,l)}})),r.set(Q.key,{view:a=>{var s;return new S(r,a,h({inlineEditConfirm:(s=t?.inlineEditConfirm)!=null?s:()=>q},t))}})}).use(ae).use(se).use(E).use(Q).use(le).use(de).use(ue)};function me(e,t){return U.renderToString(e,k(h({},t),{throwOnError:!1,displayMode:!0}))}export{Fe as defineFeature};
