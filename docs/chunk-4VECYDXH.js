import{a as Ft}from "./chunk-UDERYVLM.js";import{a as Ut,b as Kt,c as we}from "./chunk-ULSCS6NB.js";import{A as gt,B as Pt,C as xt,D as Dt,H as Gt,I as Ot,J as qt,f as bt,l as St,o as Ct,r as Tt,s as Rt,t as Ht,u as Bt,v as Wt,w as At,x as Et}from "./chunk-CM3QXDGD.js";import{a as Nt,b as zt,c as ve}from "./chunk-CYRHILKD.js";import{a as mn}from "./chunk-KEFREGMC.js";import{f as yt}from "./chunk-VCVNBPRD.js";import"./chunk-6ZGCKHA5.js";import{a as Mt,c as $t,d as Lt}from "./chunk-OJSX3Q5S.js";import{A as me,C as j,D as It,E as fe,F as P,H as q,l as he,m as g,o as pt,q as mt,s as ft,t as vt,u as wt,v as _t,x as pe,y as kt}from "./chunk-GMRP4QB5.js";import{Na as ht,Ra as X,ga as ut,ja as dt,l as ot,na as ct,s as V,va as y,w as rt,x as it}from "./chunk-WBJK5ZQV.js";import"./chunk-ILE44FN6.js";import{a as O,b as at,f as pn}from "./chunk-GAL4ENT6.js";var Qt=pn(mn(),1);var Vt= t=>{throw TypeError(t)},ye=(t, e, n)=>e.has(t)||Vt("Cannot "+n),C=(t, e, n)=>(ye(t,e,"read from private field"),n?n.call(t):e.get(t)),T=(t, e, n)=>e.has(t)?Vt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),R=(t, e, n, s)=>(ye(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n),fn=(t, e, n)=>(ye(t,e,"access private method"),n);function Jt(t){let e=X({},`${t}_SLASH_SPEC`),n=ht(a=>{let o=a.get(e.key);return new rt(O({key:new it(`${t}_SLASH`)},o))}),s=[e,n];return s.key=e.key,s.pluginKey=n.key,e.meta={package:"@milkdown/plugin-slash",displayName:`Ctx<slashSpec>|${t}`},n.meta={package:"@milkdown/plugin-slash",displayName:`Prose<slash>|${t}`},s}var Q,ee,te,ne,F,se,le,ae,_e,Yt,oe=class{constructor(e){T(this,_e),T(this,Q),T(this,ee),T(this,te),T(this,ne),T(this,F),T(this,se),T(this,le),T(this,ae),R(this,Q,!1),this.onShow=()=>{},this.onHide=()=>{},R(this,ae,(n, s)=>{var a;let{state:o,composing:d}=n,{selection:p,doc:f}=o,{ranges:$}=p,k=Math.min(...$.map(_=>_.$from.pos)),w=Math.max(...$.map(_=>_.$to.pos)),W=s&&s.doc.eq(f)&&s.selection.eq(p);if(C(this,Q)||((a=n.dom.parentElement)==null||a.appendChild(this.element),R(this,Q,!0)),!(d||W)){if(!C(this,se).call(this,n,s)){this.hide();return}Lt({getBoundingClientRect:()=>ut(n,k,w)},this.element,O({placement:"bottom-start",middleware:[$t(),Mt(C(this,le)),...C(this,ee)]},C(this,te))).then(({x:_,y:L})=>{Object.assign(this.element.style,{left:`${_}px`,top:`${L}px`})}),this.show()}}),this.update=(n, s)=>{(0,Qt.default)(C(this,ae),C(this,ne))(n,s)},this.getContent=(n, s= a=>a.type.name==="paragraph")=>{let{selection:a}=n.state,{empty:o,$from:d}=a,p=n.state.selection instanceof V,f=this.element.contains(document.activeElement),$=!n.hasFocus()&&!f,k=!n.editable,w=!ct(s)(n.state.selection);if(!($||k||!o||!p||w))return d.parent.textBetween(Math.max(0,d.parentOffset-500),d.parentOffset,void 0,"\uFFFC")},this.destroy=()=>{},this.show=()=>{this.element.dataset.show="true",this.onShow()},this.hide=()=>{this.element.dataset.show="false",this.onHide()},this.element=e.content,R(this,ne,e.debounce??200),R(this,se,e.shouldShow??fn(this,_e,Yt)),R(this,F,e.trigger??"/"),R(this,le,e.offset),R(this,ee,e.middleware??[]),R(this,te,e.floatingUIOptions??{})}};Q=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,F=new WeakMap,se=new WeakMap,le=new WeakMap,ae=new WeakMap,_e=new WeakSet,Yt=function(t){let e=this.getContent(t);if(!e)return!1;let n=e.at(-1);return n?Array.isArray(C(this,F))?C(this,F).includes(n):C(this,F)===n:!1};function de(t){let{$from:e,$to:n}=t.selection,{pos:s}=e,{pos:a}=n;return t=t.deleteRange(s-e.node().content.size,a),t}function vn(t, e, n=null){let{from:s,to:a}=t.selection;return t.setBlockType(s,a,e,n)}function wn(t, e, n=null){let{$from:s,$to:a}=t.selection,o=s.blockRange(a),d=o&&ot(o,e,n);return d?t.wrap(o,d):null}function _n(t, e, n=null){let s=e.createAndFill(n);return s?t.replaceSelectionWith(s):null}function x(t, e=null){return(n, s)=>{if(s){let a=vn(de(n.tr),t,e);s(a.scrollIntoView())}return!0}}function re(t, e=null){return(n, s)=>{let a=wn(de(n.tr),t,e);return a?(s&&s(a.scrollIntoView()),!0):!1}}function ke(t, e=null){return(n, s)=>{let a=_n(de(n.tr),t,e);return a?(s&&s(a.scrollIntoView()),!0):!1}}var Xt= t=>{throw TypeError(t)},jt=(t, e, n)=>e.has(t)||Xt("Cannot "+n),J=(t, e, n)=>(jt(t,e,"read from private field"),n?n.call(t):e.get(t)),Zt=(t, e, n)=>e.has(t)?Xt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),yn=(t, e, n, s)=>(jt(t,e,"write to private field"),e.set(t,n),n),N,ie,Le=class{constructor(){Zt(this,N,[]),this.clear=()=>(yn(this,N,[]),this),Zt(this,ie, e=>{let n={group:e,addItem:(s, a)=>{let o=O({key:s},a);return e.items.push(o),n},clear:()=>(e.items=[],n)};return n}),this.addGroup=(e, n)=>{let a={key:e,label:n,items:[]};return J(this,N).push(a),J(this,ie).call(this,a)},this.getGroup= e=>{let n=J(this,N).find(s=>s.key===e);if(!n)throw new Error(`Group with key ${e} not found`);return J(this,ie).call(this,n)},this.build=()=>J(this,N)}};N=new WeakMap;ie=new WeakMap;function kn(t, e){var n,s,a,o,d,p,f,$,k,w,W,_,L,A,E,Z,i,r,m,M,S,Te,Re,He,Be,We,Ae,Ee,ge,Pe,xe,De,Ge,Oe,qe,Fe,Ne,ze,Ue,Ke,Ve,Qe,Je,Ye,Ze,Xe,je,et,tt;let U=new Le;U.addGroup("text",(n=e?.slashMenuTextGroupLabel)!=null?n:"Text").addItem("text",{label:(s=e?.slashMenuTextGroupLabel)!=null?s:"Text",icon:(o=(a=e?.slashMenuTextIcon)==null?void 0:a.call(e))!=null?o:Ot,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(he.type(l))(h,c)}}).addItem("h1",{label:(d=e?.slashMenuH1Label)!=null?d:"Heading 1",icon:(f=(p=e?.slashMenuH1Icon)==null?void 0:p.call(e))!=null?f:Tt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:1})(h,c)}}).addItem("h2",{label:($=e?.slashMenuH2Label)!=null?$:"Heading 2",icon:(w=(k=e?.slashMenuH2Icon)==null?void 0:k.call(e))!=null?w:Rt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:2})(h,c)}}).addItem("h3",{label:(W=e?.slashMenuH3Label)!=null?W:"Heading 3",icon:(L=(_=e?.slashMenuH3Icon)==null?void 0:_.call(e))!=null?L:Ht,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:3})(h,c)}}).addItem("h4",{label:(A=e?.slashMenuH4Label)!=null?A:"Heading 4",icon:(Z=(E=e?.slashMenuH4Icon)==null?void 0:E.call(e))!=null?Z:Bt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:4})(h,c)}}).addItem("h5",{label:(i=e?.slashMenuH5Label)!=null?i:"Heading 5",icon:(m=(r=e?.slashMenuH5Icon)==null?void 0:r.call(e))!=null?m:Wt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:5})(h,c)}}).addItem("h6",{label:(M=e?.slashMenuH6Label)!=null?M:"Heading 6",icon:(Te=(S=e?.slashMenuH6Icon)==null?void 0:S.call(e))!=null?Te:At,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;x(g.type(l),{level:6})(h,c)}}).addItem("quote",{label:(Re=e?.slashMenuQuoteLabel)!=null?Re:"Quote",icon:(Be=(He=e?.slashMenuQuoteIcon)==null?void 0:He.call(e))!=null?Be:Dt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;re(pt.type(l))(h,c)}}).addItem("divider",{label:(We=e?.slashMenuDividerLabel)!=null?We:"Divider",icon:(Ee=(Ae=e?.slashMenuDividerIcon)==null?void 0:Ae.call(e))!=null?Ee:Ct,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;ke(ft.type(l))(h,c)}}),U.addGroup("list",(ge=e?.slashMenuListGroupLabel)!=null?ge:"List").addItem("bullet-list",{label:(Pe=e?.slashMenuBulletListLabel)!=null?Pe:"Bullet List",icon:(De=(xe=e?.slashMenuBulletListIcon)==null?void 0:xe.call(e))!=null?De:bt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;re(vt.type(l))(h,c)}}).addItem("ordered-list",{label:(Ge=e?.slashMenuOrderedListLabel)!=null?Ge:"Ordered List",icon:(qe=(Oe=e?.slashMenuOrderedListIcon)==null?void 0:Oe.call(e))!=null?qe:Pt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;re(wt.type(l))(h,c)}}).addItem("todo-list",{label:(Fe=e?.slashMenuTaskListLabel)!=null?Fe:"Todo List",icon:(ze=(Ne=e?.slashMenuTaskListIcon)==null?void 0:Ne.call(e))!=null?ze:qt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;re(_t.type(l),{checked:!1})(h,c)}}),U.addGroup("advanced",(Ue=e?.slashMenuAdvancedGroupLabel)!=null?Ue:"Advanced").addItem("image",{label:(Ke=e?.slashMenuImageLabel)!=null?Ke:"Image",icon:(Qe=(Ve=e?.slashMenuImageIcon)==null?void 0:Ve.call(e))!=null?Qe:Et,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;ke(Ft.type(l))(h,c)}}).addItem("code",{label:(Je=e?.slashMenuCodeBlockLabel)!=null?Je:"Code",icon:(Ze=(Ye=e?.slashMenuCodeBlockIcon)==null?void 0:Ye.call(e))!=null?Ze:St,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u;ke(mt.type(l))(h,c)}}).addItem("table",{label:(Xe=e?.slashMenuTableLabel)!=null?Xe:"Table",icon:(et=(je=e?.slashMenuTableIcon)==null?void 0:je.call(e))!=null?et:Gt,onRun: l=>{let u=l.get(y),{dispatch:c,state:h}=u,{tr:v}=h;v=de(v);let ce=v.selection.from,dn=yt(l,3,3);v=v.replaceSelectionWith(dn),c(v),requestAnimationFrame(()=>{let st=u.state.doc.content.size,cn=u.state.doc.resolve(ce>st?st:ce<0?0:ce),hn=V.near(cn),lt=u.state.tr;lt.setSelection(hn),c(lt.scrollIntoView())})}}),(tt=e?.buildMenu)==null||tt.call(e,U);let K=U.build();t&&(K=K.map(l=>{let u=l.items.filter(c=>c.label.toLowerCase().includes(t.toLowerCase()));return at(O({},l),{items:u})}).filter(l=>l.items.length>0));let nt=K.flatMap(l=>l.items);return nt.forEach((l, u)=>{Object.assign(l,{index:u})}),K.reduce((l, u)=>{let c=l+u.items.length;return Object.assign(u,{range:[l,c]}),c},0),{groups:K,size:nt.length}}var en=({show:t,hide:e,ctx:n,filter:s,config:a})=>{let{groups:o,size:d}=fe(()=>kn(s,a),[s]),p=kt(),[f,$]=It(0),k=fe(()=>p.current.getRootNode(),[p]),w=pe({x:-999,y:-999}),W=P(i=>{let r=w.current;if(!r)return;let{x:m,y:M}=i;r.x=m,r.y=M},[]);j(()=>{d===0&&t?e?.():f>=d&&$(0)},[d,t]);let _=P((i, r)=>{$(m=>{let M=typeof i=="function"?i(m):i;return r?.(M),M})},[]),L=P(i=>{let r=p.current.querySelector(`[data-index="${i}"]`),m=p.current.querySelector(".menu-groups");!r||!m||(m.scrollTop=r.offsetTop-m.offsetTop)},[]),A=P(i=>{let r=o.flatMap(m=>m.items).at(i);r&&n&&r.onRun(n),e?.()},[o]),E=P(i=>{if(i.key==="Escape"){i.preventDefault(),e?.();return}if(i.key==="ArrowDown")return i.preventDefault(),_(r=>r<d-1?r+1:r,L);if(i.key==="ArrowUp")return i.preventDefault(),_(r=>r<=0?r:r-1,L);if(i.key==="ArrowLeft")return i.preventDefault(),_(r=>{let m=o.find(S=>S.range[0]<=r&&S.range[1]>r);if(!m)return r;let M=o[o.indexOf(m)-1];return M?M.range[1]-1:r},L);if(i.key==="ArrowRight")return i.preventDefault(),_(r=>{let m=o.find(S=>S.range[0]<=r&&S.range[1]>r);if(!m)return r;let M=o[o.indexOf(m)+1];return M?M.range[0]:r},L);i.key==="Enter"&&(i.preventDefault(),A(f))},[e,o,f]),Z=P(i=> r=>{let m=w.current;if(!m)return;let{x:M,y:S}=r;M===m.x&&S===m.y||_(i)},[]);return j(()=>(t?k.addEventListener("keydown",E,{capture:!0}):k.removeEventListener("keydown",E,{capture:!0}),()=>{k.removeEventListener("keydown",E,{capture:!0})}),[t,E]),q`
    <host onmousedown=${i=>i.preventDefault()}>
      <nav class="tab-group">
        <ul>
          ${o.map(i=>q`<li
                key=${i.key}
                onmousedown=${()=>_(i.range[0],L)}
                class=${f>=i.range[0]&&f<i.range[1]?"selected":""}
              >
                ${i.label}
              </li>`)}
        </ul>
      </nav>
      <div class="menu-groups" onmousemove=${W}>
        ${o.map(i=>q`
            <div key=${i.key} class="menu-group">
              <h6>${i.label}</h6>
              <ul>
                ${i.items.map(r=>q`<li
                      key=${r.key}
                      data-index=${r.index}
                      class=${f===r.index?"hover":""}
                      onmouseenter=${Z(r.index)}
                      onmousedown=${()=>{var m;(m=p.current.querySelector(`[data-index="${r.index}"]`))==null||m.classList.add("active")}}
                      onmouseup=${()=>{var m;(m=p.current.querySelector(`[data-index="${r.index}"]`))==null||m.classList.remove("active"),A(r.index)}}
                    >
                      ${r.icon}
                      <span>${r.label}</span>
                    </li>`)}
              </ul>
            </div>
          `)}
      </div>
    </host>
  `};en.props={ctx:Object,config:Object,show:Boolean,filter:String,hide:Function};var tn=me(en),nn=t=>{throw TypeError(t)},sn=(t,e,n)=>e.has(t)||nn("Cannot "+n),I=(t,e,n)=>(sn(t,e,"read from private field"),n?n.call(t):e.get(t)),Ie=(t,e,n)=>e.has(t)?nn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Y=(t,e,n,s)=>(sn(t,e,"write to private field"),e.set(t,n),n),b,B,z,ln=Jt("CREPE_MENU"),Ce=X({show:()=>{},hide:()=>{}},"menuAPICtx");we("milkdown-slash-menu",tn);function In(t,e){t.set(ln.key,{view:n=>new be(t,n,e)})}var be=class{constructor(e,n,s){Ie(this,b),Ie(this,B),Ie(this,z,null),this.update=o=>{I(this,B).update(o)},this.show=o=>{Y(this,z,o),I(this,b).filter="",I(this,B).show()},this.hide=()=>{Y(this,z,null),I(this,B).hide()},this.destroy=()=>{I(this,B).destroy(),I(this,b).remove()},Y(this,b,new tn),I(this,b).hide=this.hide,I(this,b).ctx=e,I(this,b).config=s;let a=this;Y(this,B,new oe({content:I(this,b),debounce:20,shouldShow(o){if(Ut(o.state.selection)||Kt(o.state.selection))return!1;let d=this.getContent(o,f=>["paragraph","heading"].includes(f.type.name));if(d==null)return!1;let p=I(a,z);return I(a,b).filter=d.startsWith("/")?d.slice(1):d,typeof p=="number"?o.state.doc.resolve(p).node()!==o.state.doc.resolve(o.state.selection.from).node()?(Y(a,z,null),!1):!0:!!d.startsWith("/")},offset:10})),I(this,B).onShow=()=>{I(this,b).show=!0},I(this,B).onHide=()=>{I(this,b).show=!1},this.update(n),e.set(Ce.key,{show:o=>this.show(o),hide:()=>this.hide()})}};b=new WeakMap;B=new WeakMap;z=new WeakMap;var an=({onAdd:t,addIcon:e,handleIcon:n})=>{let s=pe();return j(()=>{var d;(d=s.current)==null||d.classList.remove("active")}),q`
    <host>
      <div
        ref=${s}
        onmousedown=${d=>{var p;d.preventDefault(),d.stopPropagation(),(p=s.current)==null||p.classList.add("active")}}
        onmouseup=${d=>{var p;d.preventDefault(),d.stopPropagation(),t?.(),(p=s.current)==null||p.classList.remove("active")}}
        class="operation-item"
      >
        ${e?.()||xt}
      </div>
      <div class="operation-item">${n?.()||gt}</div>
    </host>
  `};an.props={show:Boolean,onAdd:Function,addIcon:Function,handleIcon:Function};var on=me(an),rn=t=>{throw TypeError(t)},un=(t,e,n)=>e.has(t)||rn("Cannot "+n),H=(t,e,n)=>(un(t,e,"read from private field"),n?n.call(t):e.get(t)),Me=(t,e,n)=>e.has(t)?rn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),$e=(t,e,n,s)=>(un(t,e,"write to private field"),e.set(t,n),n),D,G,ue,Se=class{constructor(e,n){Me(this,D),Me(this,G),Me(this,ue),this.update=()=>{H(this,G).update()},this.destroy=()=>{H(this,G).destroy(),H(this,D).remove()},this.onAdd=()=>{let a=H(this,ue),o=a.get(y);o.hasFocus()||o.focus();let{state:d,dispatch:p}=o,f=H(this,G).active;if(!f)return;let k=f.$pos.pos+f.node.nodeSize,w=d.tr.insert(k,he.type(a).create());w=w.setSelection(V.near(w.doc.resolve(k))),p(w.scrollIntoView()),H(this,G).hide(),a.get(Ce.key).show(w.selection.from)},$e(this,ue,e);let s=new on;$e(this,D,s),H(this,D).onAdd=this.onAdd,H(this,D).addIcon=n?.handleAddIcon,H(this,D).handleIcon=n?.handleDragIcon,$e(this,G,new zt({ctx:e,content:s,getOffset:()=>16,getPlacement:({active:a,blockDom:o})=>{if(a.node.type.name==="heading")return"left";let d=0;a.node.descendants(A=>{d+=A.childCount});let p=a.el,f=p.getBoundingClientRect(),$=o.getBoundingClientRect(),k=window.getComputedStyle(p),w=Number.parseInt(k.paddingTop,10)||0,W=Number.parseInt(k.paddingBottom,10)||0,_=f.height-w-W,L=$.height;return d>2||L<_?"left-start":"left"}})),this.update()}};D=new WeakMap;G=new WeakMap;ue=new WeakMap;we("milkdown-block-handle",on);function Mn(t,e){t.set(Nt.key,{filterNodes:n=>!dt(a=>["table","blockquote","math_inline"].includes(a.type.name))(n)}),t.set(ve.key,{view:()=>new Se(t,e)})}var Fn=(t,e)=>{t.config(n=>Mn(n,e)).config(n=>In(n,e)).use(Ce).use(ve).use(ln)};export{Fn as defineFeature};
