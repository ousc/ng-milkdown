import{a as Y,b as q}from "./chunk-FJUI5PLB.js";import{a as $t}from "./chunk-KEFREGMC.js";import{A as K,C as Z,D as tt,H as I,I as et,i as M,x as U}from "./chunk-GMRP4QB5.js";import{Ra as C,ga as j,s as R,va as T}from "./chunk-WBJK5ZQV.js";import{f as gt}from "./chunk-GAL4ENT6.js";var ct=gt($t(),1);var Ot=Object.defineProperty,nt=Object.getOwnPropertySymbols,Et=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable,it=(e, t, n)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,St=(e, t)=>{for(var n in t||(t={}))Et.call(t,n)&&it(e,n,t[n]);if(nt)for(var n of nt(t))Lt.call(t,n)&&it(e,n,t[n]);return e};function P(e, t){return Object.assign(e,{meta:St({package:"@milkdown/components"},t)}),e}var Tt=Object.defineProperty,ot=Object.getOwnPropertySymbols,Ct=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable,rt=(e, t, n)=>t in e?Tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,z=(e, t)=>{for(var n in t||(t={}))Ct.call(t,n)&&rt(e,n,t[n]);if(ot)for(var n of ot(t))Mt.call(t,n)&&rt(e,n,t[n]);return e},It={mode:"preview"},f=C(z({},It),"linkTooltipStateCtx");P(f,{displayName:"State<link-tooltip>",group:"LinkTooltip"});var xt={addLink:()=>{},editLink:()=>{},removeLink:()=>{}},F=C(z({},xt),"linkTooltipAPICtx");P(f,{displayName:"API<link-tooltip>",group:"LinkTooltip"});var Wt={linkIcon:()=>"\u{1F517}",editButton:()=>"\u270E",removeButton:()=>"\u232B",confirmButton:()=>I`Confirm ⏎`,onCopyLink:()=>{},inputPlaceholder:"Paste link..."},J=C(z({},Wt),"linkTooltipConfigCtx");P(f,{displayName:"Config<link-tooltip>",group:"LinkTooltip"});var S=q("LINK_PREVIEW");P(S[0],{displayName:"PreviewTooltipSpec<link-tooltip>",group:"LinkTooltip"});P(S[1],{displayName:"PreviewTooltipPlugin<link-tooltip>",group:"LinkTooltip"});var V=q("LINK_EDIT");P(V[0],{displayName:"EditTooltipSpec<link-tooltip>",group:"LinkTooltip"});P(V[1],{displayName:"EditTooltipPlugin<link-tooltip>",group:"LinkTooltip"});function Dt(e, t, n, i, r){let o={start:-1,end:-1};return n.nodesBetween(i,r,(l, s)=>{if(o.start>-1)return!1;o.start===-1&&e.isInSet(l.marks)&&t===l&&(o={start:s,end:s+Math.max(l.textContent.length,1)})}),o}function bt(e, t, n){let i=t.posAtCoords({left:n.clientX,top:n.clientY});if(!i)return;let{pos:r}=i,o=t.state.doc.nodeAt(r);if(!o)return;let l=o.marks.find(u=>u.type===M.mark.type(e));if(!(!l||!S.pluginKey()))return{show:!0,pos:r,node:o,mark:l}}function ht(e, t){let n=customElements.get(e);if(n==null){customElements.define(e,t);return}n!==t&&console.warn(`Custom element ${e} has been defined before.`)}var ft=({config:e,src:t,onEdit:n,onRemove:i})=>{let r= s=>{s.stopPropagation(),s.preventDefault(),n?.()},o= s=>{s.stopPropagation(),s.preventDefault(),i?.()};return I`
    <host>
      <div class="link-preview" onmousedown=${s=>{s.preventDefault(),navigator.clipboard&&t&&navigator.clipboard.writeText(t).then(()=>{e?.onCopyLink(t)}).catch(u=>{throw u})}}>
        <span class="link-icon"> ${e?.linkIcon()} </span>
        <a href=${t} target="_blank" class="link-display">${t}</a>
        <span class="button link-edit-button" onmousedown=${r}>
          ${e?.editButton()}
        </span>
        <span
          class="button link-remove-button"
          onmousedown=${o}
        >
          ${e?.removeButton()}
        </span>
      </div>
    </host>
  `};ft.props={config:Object,src:String,onEdit:Function,onRemove:Function};var vt=K(ft),kt=e=>{throw TypeError(e)},mt=(e,t,n)=>t.has(e)||kt("Cannot "+n),a=(e,t,n)=>(mt(e,t,"read from private field"),n?n.call(e):t.get(e)),k=(e,t,n)=>t.has(e)?kt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),x=(e,t,n,i)=>(mt(e,t,"write to private field"),t.set(e,n),n),m,c,O,E,b,A,B,L,G=class{constructor(t,n){this.ctx=t,k(this,m,new vt),k(this,c),k(this,O,this.ctx.use(f.key)),k(this,E,!1),k(this,b,({mode:i})=>{i==="edit"&&a(this,L).call(this)}),k(this,A,()=>{x(this,E,!0)}),k(this,B,()=>{x(this,E,!1)}),k(this,L,()=>{a(this,c).hide(),a(this,c).element.removeEventListener("mouseenter",a(this,A)),a(this,c).element.removeEventListener("mouseleave",a(this,B))}),this.show=(i,r,o,l)=>{a(this,m).config=this.ctx.get(J.key),a(this,m).src=i.attrs.href,a(this,m).onEdit=()=>{this.ctx.get(F.key).editLink(i,r,o)},a(this,m).onRemove=()=>{this.ctx.get(F.key).removeLink(r,o),a(this,L).call(this)},a(this,c).show({getBoundingClientRect:()=>l}),a(this,c).element.addEventListener("mouseenter",a(this,A)),a(this,c).element.addEventListener("mouseleave",a(this,B))},this.hide=()=>{a(this,E)||a(this,L).call(this)},this.update=()=>{},this.destroy=()=>{a(this,O).off(a(this,b)),a(this,c).destroy(),a(this,m).remove()},x(this,c,new Y({debounce:0,content:a(this,m),shouldShow:()=>!1})),a(this,c).update(n),x(this,O,t.use(f.key)),a(this,O).on(a(this,b))}};m=new WeakMap;c=new WeakMap;O=new WeakMap;E=new WeakMap;b=new WeakMap;A=new WeakMap;B=new WeakMap;L=new WeakMap;ht("milkdown-link-preview",vt);function At(e){let t,i=(0,ct.default)((o,l)=>{if(!t||!o.hasFocus()||e.get(f.key).mode==="edit")return;let u=bt(e,o,l);if(u){let d=o.state.doc.resolve(u.pos),v=Dt(u.mark,u.node,o.state.doc,d.before(),d.after()),$=v.start,Q=v.end;t.show(u.mark,$,Q,j(o,$,Q));return}t.hide()},200),r=()=>{setTimeout(()=>{t?.hide()},200)};e.set(S.key,{props:{handleDOMEvents:{mousemove:i,mouseleave:r}},view:o=>(t=new G(e,o),t)})}var _t=({src:e,onConfirm:t,onCancel:n,config:i})=>{let r=U(),[o,l]=tt(e);Z(()=>{l(e??"")},[e]);let s=()=>{var d,v;t?.((v=(d=r.current)==null?void 0:d.value)!=null?v:"")},u=d=>{var v,$;d.stopPropagation(),d.key==="Enter"&&(t?.(($=(v=r.current)==null?void 0:v.value)!=null?$:""),d.preventDefault()),d.key==="Escape"&&(n?.(),d.preventDefault())};return I`
    <host>
      <div class="link-edit">
        <input
          class="input-area"
          placeholder=${i?.inputPlaceholder}
          ref=${r}
          onkeydown=${u}
          oninput=${d=>l(d.target.value)}
          value=${o}
        />
        <span
          class=${et("button confirm",!o&&"hidden")}
          onclick=${s}
        >
          ${i?.confirmButton()}
        </span>
      </div>
    </host>
  `};_t.props={config:Object,src:String,onConfirm:Function,onCancel:Function};var wt=K(_t),Bt=Object.defineProperty,Nt=Object.defineProperties,Ft=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,Vt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable,yt=e=>{throw TypeError(e)},at=(e,t,n)=>t in e?Bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))Vt.call(t,n)&&at(e,n,t[n]);if(st)for(var n of st(t))Rt.call(t,n)&&at(e,n,t[n]);return e},lt=(e,t)=>Nt(e,Ft(t)),Pt=(e,t,n)=>t.has(e)||yt("Cannot "+n),p=(e,t,n)=>(Pt(e,t,"read from private field"),n?n.call(e):t.get(e)),g=(e,t,n)=>t.has(e)?yt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,i)=>(Pt(e,t,"write to private field"),t.set(e,n),n),h,_,w,y,H,N,pt={from:-1,to:-1,mark:null},X=class{constructor(t,n){this.ctx=t,g(this,h,new wt),g(this,_),g(this,w,W({},pt)),g(this,y,()=>{p(this,_).hide(),this.ctx.update(f.key,i=>lt(W({},i),{mode:"preview"})),D(this,w,W({},pt))}),g(this,H,i=>{let r=this.ctx.get(T),{from:o,to:l,mark:s}=p(this,w),u=M.type(this.ctx);if(s&&s.attrs.href===i){p(this,y).call(this);return}let d=r.state.tr;s&&d.removeMark(o,l,s),d.addMark(o,l,u.create({href:i})),r.dispatch(d),p(this,y).call(this)}),g(this,N,(i,r,o)=>{let l=this.ctx.get(J.key);p(this,h).config=l,p(this,h).src=i,this.ctx.update(f.key,u=>lt(W({},u),{mode:"edit"}));let s=this.ctx.get(T);s.dispatch(s.state.tr.setSelection(R.create(s.state.doc,r,o))),p(this,_).show({getBoundingClientRect:()=>j(s,r,o)}),requestAnimationFrame(()=>{var u;(u=p(this,h).querySelector("input"))==null||u.focus()})}),this.update=i=>{let{state:r}=i,{selection:o}=r;if(!(o instanceof R))return;let{from:l,to:s}=o;l===p(this,w).from&&s===p(this,w).to||p(this,y).call(this)},this.destroy=()=>{p(this,_).destroy(),p(this,h).remove()},this.addLink=(i,r)=>{D(this,w,{from:i,to:r,mark:null}),p(this,N).call(this,"",i,r)},this.editLink=(i,r,o)=>{D(this,w,{from:r,to:o,mark:i}),p(this,N).call(this,i.attrs.href,r,o)},this.removeLink=(i,r)=>{let o=this.ctx.get(T),l=o.state.tr;l.removeMark(i,r,M.type(this.ctx)),o.dispatch(l),p(this,y).call(this)},D(this,_,new Y({content:p(this,h),debounce:0,shouldShow:()=>!1})),p(this,_).onHide=()=>{p(this,h).update().catch(i=>{throw i}),n.dom.focus({preventScroll:!0})},p(this,_).update(n),p(this,h).onConfirm=p(this,H),p(this,h).onCancel=p(this,y)}};h=new WeakMap;_=new WeakMap;w=new WeakMap;y=new WeakMap;H=new WeakMap;N=new WeakMap;var jt=Object.defineProperty,Kt=Object.defineProperties,Yt=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,qt=Object.prototype.hasOwnProperty,Gt=Object.prototype.propertyIsEnumerable,dt=(e,t,n)=>t in e?jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ht=(e,t)=>{for(var n in t||(t={}))qt.call(t,n)&&dt(e,n,t[n]);if(ut)for(var n of ut(t))Gt.call(t,n)&&dt(e,n,t[n]);return e},Xt=(e,t)=>Kt(e,Yt(t));ht("milkdown-link-edit",wt);function zt(e){let t;e.update(F.key,n=>Xt(Ht({},n),{addLink:(i,r)=>{t?.addLink(i,r)},editLink:(i,r,o)=>{t?.editLink(i,r,o)},removeLink:(i,r)=>{t?.removeLink(i,r)}})),e.set(V.key,{view:n=>(t=new X(e,n),t)})}function oe(e){At(e),zt(e)}var re=[f,F,J,S,V].flat();export{F as a,J as b,oe as c,re as d};
